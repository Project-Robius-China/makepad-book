# Makepad Project Packaging Guide

Requirements for packaging a Makepad project depend on the target platform. This guide provides an overview of how to package your Makepad application for different platforms, including desktop and mobile.

## 1. Desktop Packaging

Makepad does not provide an official desktop packaging tool, so we use the popular community tool [`cargo-packager`](https://docs.crabnebula.dev/packager/) to package your Makepad application.

### Pre-packaging checklist

#### 1. Install `cargo-packager`

```bash
cargo install cargo-packager --locked
```

This tool helps you create packages for your Makepad application, including generating the necessary files and directories for different platforms.

#### 2. Configure `cargo-packager`

You can configure `cargo-packager` in two ways:

1. Add a `[package.metadata.packager]` section in `Cargo.toml` that contains the metadata needed for packaging, including platform-specific settings (see the example below).
2. Create a new `packager.toml` file to specify other packaging options.

For more configurable parameters, see the `cargo-packager` documentation: https://docs.crabnebula.dev/packager/#configuration

This guide uses `Cargo.toml` for most app configuration as an example:

```toml
[package.metadata.packager]
product_name = "YourAppName"
identifier = "com.yourcompany.yourapp"
authors = ["Your Name or Team name"]
description = "A brief description of your Makepad application"
### Note: there is an 80-character max for each line of the `long_description`.
long_description = "..."
icons = ["./assets/icon.png"]
out_dir = "./dist"
# ... other packaging options, see the cargo-packager docs for more details.

before-packaging-command = """
robius-packaging-commands before-packaging \
    --force-makepad \
    --binary-name <main-binary-name> \
    --path-to-binary ./target/release/<main-binary-name>
"""

# We need to specify the resources that will be included in the package; the packager copies them to the output directory.
# Note: if you are using Makepad v1.0 or above, you need to specify more resource files:
resources = [
    ######### ⚠️ Makepad built-in resource files you also need to include #########
    { src = "./dist/resources/makepad_widgets", target = "makepad_widgets" },
    { src = "./dist/resources/makepad_fonts_chinese_bold", target = "makepad_fonts_chinese_bold" },
    { src = "./dist/resources/makepad_fonts_chinese_bold_2", target = "makepad_fonts_chinese_bold_2" },
    { src = "./dist/resources/makepad_fonts_chinese_regular", target = "makepad_fonts_chinese_regular" },
    { src = "./dist/resources/makepad_fonts_chinese_regular_2", target = "makepad_fonts_chinese_regular_2" },
    { src = "./dist/resources/makepad_fonts_emoji", target = "makepad_fonts_emoji" },

    ######### ⚠️ Your own project resource files #########
    { src = "./dist/resources/you_app_resource", target = "you_app_resource" },
]

before-each-package-command = """
robius-packaging-commands before-each-package \
    --force-makepad \
    --binary-name <main-binary-name> \
    --path-to-binary ./target/release/<main-binary-name> \
"""

```

We use a small `robius-packaging-commands` CLI tool to run packaging commands before packaging your Makepad application.

You can install the `robius-packaging-commands` tool with:

```bash
cargo install --version 0.2.0 --locked --git https://github.com/project-robius/robius-packaging-commands.git robius-packaging-commands
```
Note that the version of the robius-packaging-commands tool is 0.2.0.

If you prefer not to use the `robius-packaging-commands` tool, you can also write your own packaging commands. You can import your resources and Makepad resources however you like, but for simple resource importing we recommend using this tool for convenience.

For example:

```toml
# packaging/before-packaging-command is your own helper for importing resources.
# ⚠️ You still need to handle Makepad resources yourself, such as fonts.
[package.metadata.packager]

before-packaging-command = """
cargo run --manifest-path packaging/before-packaging-command/Cargo.toml before-packaging
"""

before-each-package-command = """
cargo run --manifest-path packaging/before-packaging-command/Cargo.toml before-each-package
"""
```
The `robius-packaging-commands` tool essentially performs the import work above. Only create a new hook crate for `cargo-packager` if you really need to customize the import order.

### Desktop packaging per platform

#### 1. Linux (Debian/Ubuntu)

1. Install the dependencies required for packaging:

```bash
sudo apt-get update
sudo apt-get install libssl-dev libsqlite3-dev pkg-config binfmt-support libxcursor-dev libx11-dev libasound2-dev libpulse-dev
```

2. Run the packaging command:

```bash
  cargo packager --release
```

#### 2. Windows (Windows-2022)

If you have already configured your `Cargo.toml` file as described above, you can run the packaging command:

```bash
cargo packager --release --formats nsis
```

#### 3. macOS

If you have already configured your `Cargo.toml` file as described above, you can run the packaging command:

```bash
cargo packager --release
```

See more about `robius-packaging-commands`: [https://github.com/project-robius/robius-packaging-commands/blob/main/README.md]

## 2. Mobile Packaging

Fortunately, packaging Makepad for mobile is not as complex as desktop, because Makepad provides `cargo-makepad` as the tool for mobile app packaging.

### Install `cargo-makepad`

```bash
cargo install --force --git https://github.com/makepad/makepad.git --branch dev cargo-makepad
```

### 1. Android

Android can be packaged easily using `cargo-makepad`:

```bash
cargo makepad android install-toolchain
cargo makepad android build -p your_profile_name --release # This builds the apk, then you can install it on your device or emulator.
```

### 2. iOS

```bash
cargo makepad apple ios install-toolchain
```

Use `cargo-makepad` to build the iOS app:
```bash
cargo makepad apple ios --org=organisation_name --app=product_name run-sim/run-device -p your_profile_name --release

In order for makepad to install an iOS application on a real device, a provisioning profile is needed.
To create one, make an empty application in Xcode and give it an organization name and product name that you copy exactly,
without spaces or odd characters, into --org=x and --app=x.
                         --stable use stable compiler
Also run it on the device at least once so the profile is created
                         --org=organisation_name
                         --app=product_name
If you have multiple signing identities, devices, or provisioning profiles, you might need to set them explicitly
                         --profile=
                         --cert=
                         --device=
```

Because `cargo-makepad` does not have a standalone `build` command, you can directly use the `run-sim` or `run-device` command to build the application and then package it.

```bash
# Build and run the application on the iOS simulator
cargo makepad apple ios --org=org.robius --app=robrix run-sim -p robrix --release

# The cargo-makepad tool will compile and package the iOS application, generating the corresponding app bundle in ./target/makepad-apple-app/aarch64-apple-ios-sim/release/robrix.app.
# Use the zip command to compress the .app directory into a .zip file, then distribute it or upload it to TestFlight or the App Store.

# Build and run the application on an iOS device; --device (device_identifier) can be a virtual one.
cargo makepad apple ios \
  --org=org.robius \
  --app=robrix \
  --profile=$YOUR_PROFILE_PATH \
  --cert=$YOUR_CERT_FINGERPRINT \
  --device=IPhone \
  run-device -p robrix --release

# The cargo-makepad tool will compile and package the iOS application, generating the app bundle in ./target/makepad-apple-app/aarch64-apple-ios/release/robrix.app.
cd ./target/makepad-apple-app/aarch64-apple-ios/release
mkdir Payload
cp -r robrix.app Payload/
zip -r robrix-ios.ipa Payload
# Then you can upload the generated .ipa file to TestFlight or the App Store.

```


## 3. Wasm Packaging

Makepad also supports compiling applications to WebAssembly (Wasm), which allows your app to run in the browser.

To package your application for Wasm, use the following commands:

```bash
cargo makepad wasm install-toolchain # install Wasm toolchain
cargo makepad wasm run -p your_profile_name --release
```

This builds your Makepad application as a Wasm module and runs it in the browser, while also generating the corresponding HTML and JavaScript files in the /target/makepad-wasm-app/release/your_profile_name/ directory.

It includes Makepad static resources, your application's resource files, the related js_bridge files, and the wasm module.
